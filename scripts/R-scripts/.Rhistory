library(devtools)
library(phyloseq)
library(ggplot2)
library(biomformat)
library(wesanderson)
library(dplyr)
map <- import_qiime_sample_data("/Users/biklab/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/18S/18S-euk-QIIME-mapping-MEmicrobiome-collapsedBYOceanRegion-15Nov17.txt")
map <- import_qiime_sample_data("/Users/Taruna/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/18S/18S-euk-QIIME-mapping-MEmicrobiome-collapsedBYOceanRegion-15Nov17.txt")
otu_metazoa <- import_biom("/Users/Taruna/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/18S/otu_table_mc2_w_tax_BlankOTUsRemoved_BlankSamplesRemoved_NObadnems_noZeros_NemsRemoved_above-500-kept-collapsedBYOceanRegion.biom")
physeq_metazoa = merge_phyloseq(otu_metazoa,map)
physeq_metazoa = merge_phyloseq(otu_metazoa,map)
print(physeq_metazoa)
physeq_metazoa_trans = transform_sample_counts(physeq_metazoa, function(x) 100 * x/sum(x))
any(taxa_sums(physeq_metazoa_trans) == 0)
sum(taxa_sums(physeq_metazoa_trans) == 0)
physeq_metazoa_trans_trimmed = prune_taxa(taxa_sums(physeq_metazoa_trans) > 0, physeq_metazoa_trans)
physeq_metazoa_trans_trimmed_glom <- tax_glom(physeq_metazoa_trans_trimmed, taxrank = "Rank5")
pb_meta <- plot_bar(physeq_metazoa_trans, x = "Sample", y ="Abundance", fill = "Rank5")
gb_meta <- pb_meta+geom_bar(aes(color=Rank5, fill=Rank5), stat = "identity", position="stack")
gb_meta
pb_meta <- plot_bar(physeq_metazoa_trans_trimmed, x = "Sample", y ="Abundance", fill = "Rank5")
gb_meta <- pb_meta+geom_bar(aes(color=Rank5, fill=Rank5), stat = "identity", position="stack")
gb_meta
map <- import_qiime_sample_data("/Users/biklab/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/18S/18S-euk-QIIME-mapping-MEmicrobiome-FINAL-26Jul17.txt")
map <- import_qiime_sample_data("~/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/18S/18S-euk-QIIME-mapping-MEmicrobiome-FINAL-26Jul17.txt")
otu_metazoaRemoved <- import_biom("~/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/18S/otu_table_mc2_w_tax_BlankOTUsRemoved_BlankSamplesRemoved_NObadnems_noZeros_MetazoaRemoved-above-500-kept.biom")
otu_nemsRemoved <- import_biom("~/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/18S/otu_table_mc2_w_tax_BlankOTUsRemoved_BlankSamplesRemoved_NObadnems_noZeros_NemsRemoved_above-500-kept.biom")
physeq_metazoaRemoved = merge_phyloseq(otu_metazoaRemoved,map)
physeq_nemsRemoved = merge_phyloseq(otu_nemsRemoved, map)
print(physeq_metazoaRemoved)
print(physeq_nemsRemoved)
physeq_metazoaRemoved_trans = transform_sample_counts(physeq_metazoaRemoved, function(x) 100 * x/sum(x))
physeq_nemsRemoved_trans = transform_sample_counts(physeq_nemsRemoved, function(x) 100 * x/sum(x))
any(taxa_sums(physeq_metazoaRemoved_trans) == 0)
sum(taxa_sums(physeq_metazoaRemoved_trans) == 0)
physeq_metazoaRemoved_trans_trimmed = prune_taxa(taxa_sums(physeq_metazoaRemoved_trans) > 0, physeq_metazoaRemoved_trans)
physeq_metazoaRemoved_trans_trimmed_glom <- tax_glom(physeq_metazoaRemoved_trans_trimmed, taxrank = "Rank3")
pb_meta <- plot_bar(physeq_metazoaRemoved_trans_trimmed_glom, x = "Sample", y ="Abundance", fill = "Rank3")
gb_meta <- pb_meta+geom_bar(aes(color=Rank3, fill=Rank3), stat = "identity", position="stack")
gb_meta
pb_meta <- plot_bar(physeq_metazoaRemoved_trans_trimmed_glom, x = "Sample", y ="Abundance", fill = "Rank3", facet_grid=~OceanRegion)
gb_meta <- pb_meta+geom_bar(aes(color=Rank3, fill=Rank3), stat = "identity", position="stack")
gb_meta
TopTenOTUs = names(sort(taxa_sums(physeq_metazoaRemoved_trans_trimmed_glom), TRUE)[1:20])
head(TopTenOTUs)
physeqtop10_metazoaRemoved = prune_taxa(TopTenOTUs, physeq_metazoaRemoved_trans_trimmed_glom)
rowSums(otu_table(physeqtop10_metazoaRemoved))
physeqtop10_metazoaRemoved = prune_taxa(TopTenOTUs, physeq_metazoaRemoved_trans_trimmed_glom)
rowSums(otu_table(physeqtop10_metazoaRemoved))
pb_meta10 <- plot_bar(physeqtop10_metazoaRemoved, x = "Sample", y ="Abundance", fill = "Rank2", facet_grid=~Habitat)
gb_meta10 <- pb_meta10+geom_bar(aes(color=Rank2, fill=Rank2), stat = "identity", position="stack")
gb_meta10
pb_meta10 <- plot_bar(physeqtop10_metazoaRemoved, x = "OceanRegion", y ="Abundance", fill = "Rank2", facet_grid=~Habitat)
gb_meta10 <- pb_meta10+geom_bar(aes(color=Rank2, fill=Rank2), stat = "identity", position="stack")
gb_meta10
map <- import_qiime_sample_data("/Users/Taruna/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/16S/16S-bac-QIIME-mapping-MEmicrobiome-FINAL-26Jul17.txt")
otu_Cervonema <- import_biom("/Users/Taruna/Dropbox/bik_lab/MEmicrobiome/files-4-phyloseq/16S/otu_table_mc2_w_tax_BlankOTUsRemoved_BlankSamplesRemoved_NObadnems_noZeros_Cervonema-nems.biom")
physeq_Cervonema = merge_phyloseq(otu_Cervonema,map)
physeq_Cervonema
physeq_Cervonema_trans = transform_sample_counts(physeq_Cervonema, function(x) 100 * x/sum(x))
any(taxa_sums(physeq_Cervonema_trans) == 0)
sum(taxa_sums(physeq_Cervonema_trans) == 0)
physeq_Cervonema_trans_trimmed = prune_taxa(taxa_sums(physeq_Cervonema_trans) > 0, physeq_Cervonema_trans)
pb_cervonema <- plot_bar(physeq_Cervonema_trans_trimmed, x = "Sample", y ="Abundance", fill = "Rank5")
gb_cervonema <- pb_cervonema+geom_bar(aes(color=Rank5, fill=Rank5), stat = "identity", position="stack")
gb_cervonema
pb_cervonema <- plot_bar(physeq_Cervonema_trans_trimmed, x = "Sample", y ="Abundance", fill = "Rank2")
gb_cervonema <- pb_cervonema+geom_bar(aes(color=Rank2, fill=Rank2), stat = "identity", position="stack")
gb_cervonema
TopTenOTUs = names(sort(taxa_sums(physeq_Cervonema_trans_trimmed), TRUE)[1:20])
head(TopTenOTUs)
physeqtop10_cervonema = prune_species(TopTenOTUs, physeq_Cervonema_trans_trimmed)
physeqtop10_cervonema = prune_taxa(TopTenOTUs, physeq_Cervonema_trans_trimmed)
plot_bar(physeqtop10_cervonema, x = "Sample", y ="Abundance", fill = "Rank2")
